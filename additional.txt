CREATE OR REPLACE PROCEDURE GET_M_ID(OUT M_ID_REQ INTEGER) 
BEGIN 
	SELECT MAX(M_ID) INTO M_ID_REQ FROM MASJID; 
END 

CREATE OR REPLACE FUNCTION GET_YEAR(M_ID_GOT INTEGER) 
RETURNS DECIMAL(4) 
DETERMINISTIC 
BEGIN 
	DECLARE YEAR_GOT DECIMAL(4) ; 

	SELECT MAX(YEAR) INTO YEAR_GOT FROM expendature WHERE M_ID = M_ID_GOT ; 
	RETURN(YEAR_GOT) ; 
END 

CREATE TRIGGER total_amount_calc 
BEFORE INSERT ON expendature 
FOR EACH ROW 
BEGIN 
	SET NEW.total_amount = NEW.total_amount + NEW.amount; 
END 

CREATE OR REPLACE FUNCTION GET_TOTAL(M_ID_GOT INTEGER) 
RETURNS DECIMAL(20) 
DETERMINISTIC 
BEGIN 
	DECLARE TOTAL_GOT DECIMAL(20) ; 

	SELECT TOTAL_AMOUNT INTO TOTAL_GOT FROM expendature WHERE M_ID = M_ID_GOT AND YEAR = (SELECT MAX(YEAR) FROM expendature WHERE M_ID = M_ID_GOT); 
	RETURN(TOTAL_GOT) ; 
END 

SELECT m.M_ID as M_ID, NAME, ADDRESS, EQUIPMENTS
FROM MASJID as m left join (select sum(count) as EQUIPMENTS, m_id from equipment GROUP by m_id) as dum on m.m_id = dum.m_id;

---------------------------------------------------------------------------------------------------------------

SELECT NAME, M_NAME, DESIGNATION_NAME, PHONE_NUM FROM 
	(SELECT X.NAME AS NAME, Y.NAME AS M_NAME, DESIGNATION_ID, PHONE_NUM FROM 
		(( SELECT M_ID, NAME, DESIGNATION_ID, PHONE_NUM FROM IMAM_MUAJJIN ) UNION ( SELECT M_ID, NAME, DESIGNATION_ID, PHONE_NUM FROM MASHJID_COMITTE ))
			 AS X, (SELECT * FROM MASJID ) AS Y WHERE X.M_ID = Y.M_ID) AS P, ( SELECT * FROM DESIGNATION_SET) AS Q WHERE P.DESIGNATION_ID = Q.DESIGNATION_ID ;